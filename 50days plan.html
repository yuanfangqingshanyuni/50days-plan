<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>50å¤©æ‰“å¡è®¡åˆ’</title>

    <!-- ===== PWA æ–°å¢ 1ï¼šå…³è” manifest ===== -->
    <link rel="manifest" href="manifest.json">

    <!-- ===== PWA æ–°å¢ 2ï¼šæ³¨å†Œ service-worker ===== -->
    <script>
        if ('serviceWorker' in navigator)
            window.addEventListener('load', () => navigator.serviceWorker.register('sw.js'));
    </script>

    <!-- ä»¥ä¸‹éƒ½æ˜¯ä½ åŸæ¥çš„ head å†…å®¹ -->
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="æ‰“å¡è®¡åˆ’">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“±</text></svg>">

    <style>
        /* ä½ çš„æ ·å¼åŸæ ·ä¿ç•™ï¼Œæ­¤å¤„çœç•¥èŠ‚çœç¯‡å¹… */
        *{margin:0;padding:0;box-sizing:border-box;font-family:'PingFang SC','Microsoft YaHei',sans-serif}
        body{background:#f5f7fa;color:#333;line-height:1.6;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}
        .container{max-width:500px;margin:0 auto;padding:20px;background:#fff;min-height:100vh;box-shadow:0 0 10px rgba(0,0,0,.05)}
        header{text-align:center;margin-bottom:30px;padding:20px 0;background:linear-gradient(135deg,#4CAF50 0%,#2196F3 100%);color:#fff;border-radius:10px;box-shadow:0 4px 12px rgba(33,150,243,.3);position:relative}
        h1{font-size:28px;margin-bottom:10px;letter-spacing:2px}
        h2{font-size:20px;font-weight:400;margin-bottom:5px}
        .subtitle{font-size:16px;opacity:.9}
        .login-section,.setup-section,.main-section,.congrats-section,.settings-section{display:none}
        .active{display:block}
        .form-group{margin-bottom:20px}
        label{display:block;margin-bottom:8px;font-weight:500}
        input,select,textarea{width:100%;padding:12px 15px;border:1px solid #ddd;border-radius:8px;font-size:16px;transition:border .3s}
        input:focus,select:focus,textarea:focus{border-color:#2196F3;outline:none}
        .btn{display:block;width:100%;padding:14px;background:linear-gradient(135deg,#4CAF50 0%,#2196F3 100%);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:500;cursor:pointer;transition:transform .2s,box-shadow .2s;margin-top:10px}
        .btn:hover,.btn:active{transform:translateY(-2px);box-shadow:0 4px 12px rgba(33,150,243,.3)}
        .btn-secondary{background:linear-gradient(135deg,#757575 0%,#9e9e9e 100%)}
        .btn-danger{background:linear-gradient(135deg,#f44336 0%,#e57373 100%)}
        .btn-small{padding:8px 15px;font-size:14px;width:auto;display:inline-block;margin:5px}
        .task-list{margin-top:20px}
        .task-item{display:flex;align-items:center;padding:15px;margin-bottom:12px;background:#f8f9fa;border-radius:8px;border-left:4px solid #2196F3;transition:all .3s}
        .task-item:hover{background:#e8f4fd}
        .task-checkbox{width:24px;height:24px;margin-right:15px;border-radius:50%;border:2px solid #2196F3;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}
        .task-checkbox.checked{background:#2196F3}
        .task-checkbox.checked::after{content:"âœ“";color:#fff;font-size:14px}
        .task-content{flex:1}
        .task-title{font-weight:500;margin-bottom:5px}
        .task-desc{font-size:14px;color:#666}
        .progress-section{position:fixed;bottom:0;left:0;right:0;background:#fff;padding:15px 20px;border-top:1px solid #eee;text-align:center;box-shadow:0 -2px 10px rgba(0,0,0,.05)}
        .progress-text{font-size:16px;margin-bottom:5px}
        .progress-bar{height:8px;background:#e9ecef;border-radius:4px;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(135deg,#4CAF50 0%,#2196F3 100%);border-radius:4px;transition:width .5s}
        .congrats-section{text-align:center;padding:40px 20px}
        .congrats-icon{font-size:80px;color:#2196F3;margin-bottom:20px}
        .congrats-title{font-size:24px;margin-bottom:15px;color:#2196F3}
        .congrats-text{margin-bottom:30px;color:#666}
        .back-btn{background:linear-gradient(135deg,#4CAF50 0%,#2196F3 100%);color:#fff;border:none;padding:12px 25px;border-radius:8px;font-size:16px;cursor:pointer;transition:transform .2s}
        .back-btn:hover,.back-btn:active{transform:translateY(-2px)}
        .date-display{text-align:center;margin:15px 0;font-size:16px;color:#666;padding:10px;background:#f0f8ff;border-radius:8px}
        .settings-icon{position:absolute;top:20px;right:20px;font-size:24px;cursor:pointer;color:#fff;transition:transform .3s}
        .settings-icon:hover{transform:rotate(90deg)}
        .settings-section h2{margin-bottom:20px;text-align:center;color:#2196F3}
        .settings-actions{margin-top:30px}
        .reset-warning{background:#ffebee;border:1px solid #f44336;border-radius:8px;padding:15px;margin:20px 0;text-align:center}
        .task-edit-item{margin-bottom:15px;padding:15px;background:#f8f9fa;border-radius:8px}
        .task-edit-title{font-weight:500;margin-bottom:8px;color:#2196F3}
        .add-task-btn{background:linear-gradient(135deg,#4CAF50 0%,#2196F3 100%);color:#fff;border:none;padding:10px 15px;border-radius:8px;font-size:14px;cursor:pointer;margin:10px 0}
        .delete-task-btn{background:linear-gradient(135deg,#f44336 0%,#e57373 100%);color:#fff;border:none;padding:5px 10px;border-radius:5px;font-size:12px;cursor:pointer;margin-top:5px}
        .task-management{margin:20px 0}
        .install-prompt{background:linear-gradient(135deg,#4CAF50 0%,#2196F3 100%);color:#fff;padding:15px;border-radius:10px;text-align:center;margin-bottom:20px;display:none}
        .install-btn{background:#fff;color:#2196F3;border:none;padding:10px 20px;border-radius:20px;font-weight:700;margin-top:10px;cursor:pointer}
    </style>
</head>
<body>
    <div class="container">
        <div class="install-prompt" id="install-prompt">
            <p>ğŸ“± å°†æ­¤åº”ç”¨å®‰è£…åˆ°æ‰‹æœºï¼Œè·å¾—æ›´å¥½çš„ä½“éªŒï¼</p>
            <button class="install-btn" id="install-btn">å®‰è£…åº”ç”¨</button>
        </div>

        <header>
            <h1>50å¤©æ‰“å¡è®¡åˆ’</h1>
            <div class="subtitle">50å¤©æ”¹å˜äººç”Ÿ</div>
            <div class="settings-icon" id="settings-btn">âš™ï¸</div>
        </header>

        <!-- ç™»å½•ç•Œé¢ -->
        <section id="login-section" class="login-section active">
            <div class="form-group">
                <label for="user-id">è¯·è¾“å…¥ä½ çš„ID</label>
                <input type="text" id="user-id" placeholder="è¾“å…¥ä½ çš„ç”¨æˆ·åæˆ–ID">
            </div>
            <button id="login-btn" class="btn">å¼€å§‹æŒ‘æˆ˜</button>
        </section>

        <!-- è®¾ç½®ç•Œé¢ -->
        <section id="setup-section" class="setup-section">
            <h2>ä¸ªæ€§åŒ–ä½ çš„æ‰“å¡è®¡åˆ’</h2>
            <div class="form-group">
                <label for="start-date">é€‰æ‹©å¼€å§‹æ—¥æœŸ</label>
                <input type="date" id="start-date">
            </div>

            <h3 style="margin: 20px 0 10px;">è‡ªå®šä¹‰æ‰“å¡é¡¹ç›®</h3>

            <div id="task-setup-list">
                <!-- ä»»åŠ¡è®¾ç½®é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <button id="add-task-btn" class="add-task-btn">+ æ·»åŠ æ–°ä»»åŠ¡</button>

            <button id="save-setup-btn" class="btn">ä¿å­˜è®¾ç½®å¹¶å¼€å§‹æ‰“å¡</button>
        </section>

        <!-- ä¸»æ‰“å¡ç•Œé¢ -->
        <section id="main-section" class="main-section">
            <div class="date-display" id="current-date"></div>
            <h2>ä»Šæ—¥æ‰“å¡ä»»åŠ¡</h2>
            <div id="task-list" class="task-list">
                <!-- ä»»åŠ¡åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <div class="progress-section">
                <div class="progress-text">å·²å®Œæˆ <span id="completed-days">0</span> / 50 å¤©</div>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
        </section>

        <!-- å®Œæˆæ‰“å¡ç•Œé¢ -->
        <section id="congrats-section" class="congrats-section">
            <div class="congrats-icon">ğŸ‰</div>
            <h2 class="congrats-title" id="congrats-message">æ­å–œä½ å®Œæˆä»Šæ—¥æ‰“å¡ï¼</h2>
            <p class="congrats-text">åšæŒå°±æ˜¯èƒœåˆ©ï¼Œæ˜å¤©ç»§ç»­åŠ æ²¹ï¼</p>
            <button id="back-to-main-btn" class="back-btn">è¿”å›æ‰“å¡ç•Œé¢</button>
        </section>

        <!-- è®¾ç½®ç•Œé¢ -->
        <section id="settings-section" class="settings-section">
            <h2>è®¾ç½®</h2>

            <div class="form-group">
                <label for="settings-user-id">ç”¨æˆ·ID</label>
                <input type="text" id="settings-user-id" placeholder="è¾“å…¥æ–°çš„ç”¨æˆ·ID">
            </div>

            <div class="task-management">
                <h3>ç®¡ç†æ‰“å¡ä»»åŠ¡</h3>
                <p>æ‚¨å¯ä»¥ä¿®æ”¹ä»»åŠ¡æ ‡é¢˜å’Œæè¿°ï¼Œæˆ–æ·»åŠ æ–°çš„ä»»åŠ¡</p>
                <div id="settings-task-list">
                    <!-- ä»»åŠ¡ç¼–è¾‘åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <button id="add-task-settings-btn" class="add-task-btn">+ æ·»åŠ æ–°ä»»åŠ¡</button>
            </div>

            <div class="settings-actions">
                <h3>é‡ç½®è¿›åº¦</h3>
                <div class="reset-warning">
                    <p>é‡ç½®åï¼Œæ‰€æœ‰æ‰“å¡è¿›åº¦å°†è¢«æ¸…é™¤ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼</p>
                </div>
                <button id="reset-progress-btn" class="btn btn-danger">é‡ç½®æ‰“å¡è¿›åº¦</button>
            </div>

            <button id="save-settings-btn" class="btn">ä¿å­˜è®¾ç½®</button>
            <button id="back-from-settings-btn" class="btn btn-secondary">è¿”å›</button>
        </section>
    </div>

    <script>
        // é»˜è®¤ä»»åŠ¡åˆ—è¡¨
        const defaultTasks = [
            { id: 1, title: "æ—©ä¸Š8ç‚¹å‰èµ·åºŠ", description: "å¹¶ä¿è¯æ¯æ™šè‡³å°‘6å°æ—¶çš„ç¡çœ ï¼Œç»´æŒè§„å¾‹çš„ä½œæ¯" },
            { id: 2, title: "1å°æ—¶æ— å¹²æ‰°çš„æ™¨é—´ä»ªå¼", description: "ä¸“æ³¨äºæ™¨é—´æ´»åŠ¨ï¼Œå†¥æƒ³ï¼Œæ•£æ­¥ï¼Œæ€è€ƒç­‰" },
            { id: 3, title: "1å°æ—¶è¿åŠ¨", description: "å½¢å¼ä¸é™ï¼Œåªéœ€ä¿è¯æ¯å¤©éƒ½è¿›è¡Œ1å°æ—¶çš„èº«ä½“æ´»åŠ¨" },
            { id: 4, title: "é˜…è¯»10é¡µä¹¦", description: "å¯ä»¥è¯»ä»»ä½•ä½ å–œæ¬¢çš„ä¹¦ç±ã€æ–‡ç« " },
            { id: 5, title: "èŠ±1å°æ—¶å­¦ä¹ æŠ€èƒ½", description: "é€‰æ‹©ä½ çœŸæ­£æ„Ÿå…´è¶£çš„æŠ€èƒ½ï¼Œæ¯”å¦‚ç»˜ç”»ã€æ–°è¯­è¨€ç­‰" },
            { id: 6, title: "å¥åº·é¥®é£Ÿ", description: "å‘Šåˆ«åƒåœ¾é£Ÿå“ï¼Œé…’ç²¾å’Œè½¯é¥®æ–™" },
            { id: 7, title: "è®°å½•è¿›åº¦", description: "é€šè¿‡å†™æ—¥è®°ç­‰å½¢å¼è®°å½•è‡ªå·±çš„ç»å†å’Œæ„Ÿå—" }
        ];

        // è·å–DOMå…ƒç´ 
        const loginSection = document.getElementById('login-section');
        const setupSection = document.getElementById('setup-section');
        const mainSection = document.getElementById('main-section');
        const congratsSection = document.getElementById('congrats-section');
        const settingsSection = document.getElementById('settings-section');
        const installPrompt = document.getElementById('install-prompt');
        const installBtn = document.getElementById('install-btn');

        const loginBtn = document.getElementById('login-btn');
        const saveSetupBtn = document.getElementById('save-setup-btn');
        const backToMainBtn = document.getElementById('back-to-main-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const backFromSettingsBtn = document.getElementById('back-from-settings-btn');
        const resetProgressBtn = document.getElementById('reset-progress-btn');
        const addTaskBtn = document.getElementById('add-task-btn');
        const addTaskSettingsBtn = document.getElementById('add-task-settings-btn');

        const taskSetupList = document.getElementById('task-setup-list');
        const taskList = document.getElementById('task-list');
        const settingsTaskList = document.getElementById('settings-task-list');
        const completedDaysEl = document.getElementById('completed-days');
        const progressFill = document.getElementById('progress-fill');
        const currentDateEl = document.getElementById('current-date');
        const congratsMessage = document.getElementById('congrats-message');
        const settingsUserId = document.getElementById('settings-user-id');

        // ä»»åŠ¡IDè®¡æ•°å™¨
        let taskIdCounter = 100;
        let deferredPrompt;

        // PWAå®‰è£…æç¤º
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPrompt.style.display = 'block';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installPrompt.style.display = 'none';
                }
                deferredPrompt = null;
            }
        });

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            // æ£€æŸ¥æ˜¯å¦å·²æœ‰ç”¨æˆ·æ•°æ®
            const userData = localStorage.getItem('userData');
            if (userData) {
                showSection(mainSection);
                loadUserData();
            } else {
                showSection(loginSection);
            }

            // è®¾ç½®é»˜è®¤å¼€å§‹æ—¥æœŸä¸ºä»Šå¤©
            document.getElementById('start-date').valueAsDate = new Date();

            // ç”Ÿæˆä»»åŠ¡è®¾ç½®ç•Œé¢
            renderTaskSetup();

            // æ›´æ–°å½“å‰æ—¥æœŸæ˜¾ç¤º
            updateCurrentDate();
        }

        // æ›´æ–°å½“å‰æ—¥æœŸæ˜¾ç¤º
        function updateCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            currentDateEl.textContent = now.toLocaleDateString('zh-CN', options);
        }

        // æ¸²æŸ“ä»»åŠ¡è®¾ç½®ç•Œé¢
        function renderTaskSetup() {
            taskSetupList.innerHTML = '';
            const tasks = getTasksForSetup();

            tasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-edit-item';
                taskItem.innerHTML = `
                    <div class="form-group">
                        <label>ä»»åŠ¡æ ‡é¢˜</label>
                        <input type="text" class="task-title-input" value="${task.title}" placeholder="è¾“å…¥ä»»åŠ¡æ ‡é¢˜" data-id="${task.id}">
                    </div>
                    <div class="form-group">
                        <label>ä»»åŠ¡æè¿°</label>
                        <textarea class="task-desc-input" placeholder="è¾“å…¥ä»»åŠ¡æè¿°" rows="2" data-id="${task.id}">${task.description}</textarea>
                    </div>
                    ${task.id > 7 ? `<button class="delete-task-btn" data-id="${task.id}">åˆ é™¤ä»»åŠ¡</button>` : ''}
                `;
                taskSetupList.appendChild(taskItem);
            });

            // æ·»åŠ åˆ é™¤ä»»åŠ¡äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-task-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    deleteTask(taskId);
                    renderTaskSetup();
                });
            });
        }

        // è·å–è®¾ç½®ç•Œé¢çš„ä»»åŠ¡åˆ—è¡¨
        function getTasksForSetup() {
            const userData = localStorage.getItem('userData');
            if (userData) {
                return JSON.parse(userData).tasks;
            }
            return defaultTasks;
        }

        // æ¸²æŸ“è®¾ç½®ç•Œé¢çš„ä»»åŠ¡ç¼–è¾‘åˆ—è¡¨
        function renderSettingsTaskList() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            const tasks = userData.tasks || defaultTasks;

            settingsTaskList.innerHTML = '';
            tasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-edit-item';
                taskItem.innerHTML = `
                    <div class="form-group">
                        <label>ä»»åŠ¡æ ‡é¢˜</label>
                        <input type="text" class="settings-task-title-input" value="${task.title}" placeholder="è¾“å…¥ä»»åŠ¡æ ‡é¢˜" data-id="${task.id}">
                    </div>
                    <div class="form-group">
                        <label>ä»»åŠ¡æè¿°</label>
                        <textarea class="settings-task-desc-input" placeholder="è¾“å…¥ä»»åŠ¡æè¿°" rows="2" data-id="${task.id}">${task.description}</textarea>
                    </div>
                    ${task.id > 7 ? `<button class="delete-task-btn" data-id="${task.id}">åˆ é™¤ä»»åŠ¡</button>` : ''}
                `;
                settingsTaskList.appendChild(taskItem);
            });

            // æ·»åŠ åˆ é™¤ä»»åŠ¡äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-task-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    deleteTask(taskId);
                    renderSettingsTaskList();
                });
            });
        }

        // æ¸²æŸ“ä¸»æ‰“å¡ç•Œé¢
        function renderMainSection() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            const tasks = userData.tasks || defaultTasks;

            taskList.innerHTML = '';
            tasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.innerHTML = `
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" data-id="${task.id}"></div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-desc">${task.description}</div>
                    </div>
                `;
                taskList.appendChild(taskItem);
            });

            // æ›´æ–°è¿›åº¦
            updateProgress();

            // æ·»åŠ ä»»åŠ¡ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', function() {
                    this.classList.toggle('checked');
                    const taskId = parseInt(this.getAttribute('data-id'));
                    toggleTaskCompletion(taskId);

                    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆ
                    if (areAllTasksCompleted()) {
                        showSection(congratsSection);
                        updateCompletedDays();
                        // æ˜¾ç¤ºä¸ªæ€§åŒ–ç¥è´ºæ¶ˆæ¯
                        congratsMessage.textContent = `æ­å–œä½ ${userData.userId}ï¼Œå®Œæˆä»Šæ—¥æ‰“å¡ï¼`;
                    }
                });
            });
        }

        // æ·»åŠ æ–°ä»»åŠ¡
        function addNewTask() {
            taskIdCounter++;
            const newTask = {
                id: taskIdCounter,
                title: "æ–°ä»»åŠ¡",
                description: "è¯·è¾“å…¥ä»»åŠ¡æè¿°",
                completed: false
            };

            return newTask;
        }

        // åˆ é™¤ä»»åŠ¡
        function deleteTask(taskId) {
            const userData = JSON.parse(localStorage.getItem('userData'));
            userData.tasks = userData.tasks.filter(task => task.id !== taskId);
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        // åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
        function toggleTaskCompletion(taskId) {
            const userData = JSON.parse(localStorage.getItem('userData'));
            const task = userData.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                localStorage.setItem('userData', JSON.stringify(userData));
            }
        }

        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆ
        function areAllTasksCompleted() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            return userData.tasks.every(task => task.completed);
        }

        // æ›´æ–°å·²å®Œæˆå¤©æ•°
        function updateCompletedDays() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            if (!userData.completedDays) userData.completedDays = 0;

            // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç»å®Œæˆè¿‡æ‰“å¡
            const today = new Date().toDateString();
            if (userData.lastCompletedDate !== today) {
                userData.completedDays++;
                userData.lastCompletedDate = today;
                localStorage.setItem('userData', JSON.stringify(userData));
            }

            updateProgress();
        }

        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            const completedDays = userData.completedDays || 0;
            const progress = (completedDays / 50) * 100;

            completedDaysEl.textContent = completedDays;
            progressFill.style.width = `${progress}%`;
        }

        // åŠ è½½ç”¨æˆ·æ•°æ®
        function loadUserData() {
            renderMainSection();
        }

        // æ˜¾ç¤ºæŒ‡å®šç•Œé¢
        function showSection(section) {
            loginSection.classList.remove('active');
            setupSection.classList.remove('active');
            mainSection.classList.remove('active');
            congratsSection.classList.remove('active');
            settingsSection.classList.remove('active');

            section.classList.add('active');
        }

        // äº‹ä»¶ç›‘å¬
        loginBtn.addEventListener('click', function() {
            const userId = document.getElementById('user-id').value.trim();
            if (userId) {
                showSection(setupSection);
            } else {
                alert('è¯·è¾“å…¥ä½ çš„ID');
            }
        });

        saveSetupBtn.addEventListener('click', function() {
            const startDate = document.getElementById('start-date').value;

            // è·å–è‡ªå®šä¹‰çš„ä»»åŠ¡
            const tasks = [];
            const titleInputs = document.querySelectorAll('.task-title-input');
            const descInputs = document.querySelectorAll('.task-desc-input');

            titleInputs.forEach(input => {
                const taskId = parseInt(input.getAttribute('data-id'));
                const title = input.value.trim();
                const descInput = document.querySelector(`.task-desc-input[data-id="${taskId}"]`);
                const description = descInput ? descInput.value.trim() : "";

                if (title) {
                    tasks.push({
                        id: taskId,
                        title: title,
                        description: description,
                        completed: false
                    });
                }
            });

            if (tasks.length === 0) {
                alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªä»»åŠ¡ï¼');
                return;
            }

            // ä¿å­˜ç”¨æˆ·æ•°æ®
            const userData = {
                userId: document.getElementById('user-id').value,
                startDate: startDate,
                tasks: tasks,
                completedDays: 0,
                lastCompletedDate: null
            };

            localStorage.setItem('userData', JSON.stringify(userData));
            showSection(mainSection);
            renderMainSection();
        });

        backToMainBtn.addEventListener('click', function() {
            showSection(mainSection);

            // é‡ç½®ä»»åŠ¡å®ŒæˆçŠ¶æ€
            const userData = JSON.parse(localStorage.getItem('userData'));
            userData.tasks.forEach(task => {
                task.completed = false;
            });
            localStorage.setItem('userData', JSON.stringify(userData));

            renderMainSection();
        });

        settingsBtn.addEventListener('click', function() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            if (userData) {
                // åŠ è½½å½“å‰è®¾ç½®
                settingsUserId.value = userData.userId;
                renderSettingsTaskList();
                showSection(settingsSection);
            }
        });

        saveSettingsBtn.addEventListener('click', function() {
            const userData = JSON.parse(localStorage.getItem('userData'));

            // æ›´æ–°ç”¨æˆ·ID
            const newUserId = settingsUserId.value.trim();
            if (newUserId) {
                userData.userId = newUserId;
            }

            // æ›´æ–°ä»»åŠ¡
            const tasks = [];
            const titleInputs = document.querySelectorAll('.settings-task-title-input');
            const descInputs = document.querySelectorAll('.settings-task-desc-input');

            titleInputs.forEach(input => {
                const taskId = parseInt(input.getAttribute('data-id'));
                const title = input.value.trim();
                const descInput = document.querySelector(`.settings-task-desc-input[data-id="${taskId}"]`);
                const description = descInput ? descInput.value.trim() : "";

                if (title) {
                    tasks.push({
                        id: taskId,
                        title: title,
                        description: description,
                        completed: false
                    });
                }
            });

            if (tasks.length === 0) {
                alert('è¯·è‡³å°‘ä¿ç•™ä¸€ä¸ªä»»åŠ¡ï¼');
                return;
            }

            userData.tasks = tasks;

            // ä¿å­˜æ›´æ–°åçš„æ•°æ®
            localStorage.setItem('userData', JSON.stringify(userData));

            alert('è®¾ç½®å·²ä¿å­˜ï¼');
            showSection(mainSection);
            renderMainSection();
        });

        backFromSettingsBtn.addEventListener('click', function() {
            showSection(mainSection);
        });

        resetProgressBtn.addEventListener('click', function() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ‰“å¡è¿›åº¦å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                const userData = JSON.parse(localStorage.getItem('userData'));

                // é‡ç½®è¿›åº¦
                userData.completedDays = 0;
                userData.lastCompletedDate = null;
                userData.tasks.forEach(task => {
                    task.completed = false;
                });

                // ä¿å­˜é‡ç½®åçš„æ•°æ®
                localStorage.setItem('userData', JSON.stringify(userData));

                alert('æ‰“å¡è¿›åº¦å·²é‡ç½®ï¼');
                showSection(mainSection);
                renderMainSection();
            }
        });

        addTaskBtn.addEventListener('click', function() {
            const newTask = addNewTask();
            const tasks = getTasksForSetup();
            tasks.push(newTask);

            // æ›´æ–°æœ¬åœ°å­˜å‚¨
            const userData = localStorage.getItem('userData');
            if (userData) {
                const data = JSON.parse(userData);
                data.tasks = tasks;
                localStorage.setItem('userData', JSON.stringify(data));
            }

            renderTaskSetup();
        });

        addTaskSettingsBtn.addEventListener('click', function() {
            const newTask = addNewTask();
            const userData = JSON.parse(localStorage.getItem('userData'));
            userData.tasks.push(newTask);
            localStorage.setItem('userData', JSON.stringify(userData));

            renderSettingsTaskList();
        });

        // åˆå§‹åŒ–åº”ç”¨
        initApp();
    </script>
</body>
</html>